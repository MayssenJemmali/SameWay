<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course en cours</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        #map {
            width: 100%;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        .header-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: white;
            border-bottom: 1px solid #e5e7eb;
        }
        .info-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem;
            pointer-events: none;
        }
        .info-card-overlay > div {
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <!-- Map takes full viewport -->
    <div id="map"></div>

    <!-- Header overlay -->
    <div class="header-overlay">
        <div class="py-4 md:py-5">
            <h1 class="text-[#003d6b] text-3xl md:text-4xl font-bold text-center">Course en route</h1>
        </div>
    </div>

    <!-- Info Card overlay - floating on top of map -->
    <div class="info-card-overlay">
        <div class="max-w-2xl mx-auto">
            <div class="bg-[#c8e6f5] rounded-2xl px-6 md:px-8 py-5 md:py-6 shadow-lg">
                <div class="flex items-center justify-between gap-4">
                    <!-- Left side - Course info -->
                    <div class="flex-1">
                        <h2 class="text-[#003d6b] text-xl md:text-2xl font-semibold mb-2">Course en cours</h2>
                        <div class="flex items-center gap-2 text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" stroke-width="2"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6l4 2"/>
                            </svg>
                            <span class="text-lg md:text-xl"><span class="font-semibold text-[#003d6b]">15min</span> restantes</span>
                        </div>
                    </div>
                    
                    <!-- Right side - Emergency button -->
                    <button class="bg-white border-2 border-[#003d6b] text-[#003d6b] px-6 md:px-8 py-3 rounded-lg flex items-center gap-2 hover:bg-gray-50 transition-colors flex-shrink-0">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
                        </svg>
                        <span class="font-semibold text-base md:text-lg">Urgence</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize map - centered on Tunis, Tunisia
        const map = L.map('map', {
            zoomControl: true,
            scrollWheelZoom: true,
            dragging: true
        }).setView([36.9020, 10.1870], 14);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);

        // Destination marker (ESPRIT Engineering School)
        const destinationIcon = L.divIcon({
            className: 'custom-destination-icon',
            html: `
                <div style="position: relative; width: 40px; height: 50px;">
                    <svg width="40" height="50" viewBox="0 0 40 50">
                        <path d="M20 0C11.2 0 4 7.2 4 16c0 12 16 34 16 34s16-22 16-34c0-8.8-7.2-16-16-16z" fill="#e53e3e"/>
                        <circle cx="20" cy="16" r="8" fill="white"/>
                    </svg>
                    <div style="position: absolute; top: 52px; left: 50%; transform: translateX(-50%); white-space: nowrap; background: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; color: #e53e3e; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">ESPRIT<br><span style="font-size: 10px; font-weight: normal;">engineering school</span></div>
                </div>
            `,
            iconSize: [40, 50],
            iconAnchor: [20, 50]
        });
        
        const destinationPos = [36.9050, 10.1950];
        const destination = L.marker(destinationPos, { icon: destinationIcon }).addTo(map);

        // Car icon for driver
        const carIcon = L.divIcon({
            className: 'custom-car-icon',
            html: `
                <div style="background: #1a202c; border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; box-shadow: 0 3px 10px rgba(0,0,0,0.4);">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                    </svg>
                </div>
            `,
            iconSize: [36, 36],
            iconAnchor: [18, 18]
        });

        const driverLocation = [36.9000, 10.1870];
        const driver = L.marker(driverLocation, { icon: carIcon }).addTo(map);

        // Path already traveled (dotted line going down/left from car)
        const traveledPath = [
            driverLocation,
            [36.8980, 10.1860],
            [36.8950, 10.1840],
            [36.8920, 10.1820]
        ];

        L.polyline(traveledPath, {
            color: '#003d6b',
            weight: 3,
            dashArray: '8, 12',
            opacity: 0.7,
            lineCap: 'round'
        }).addTo(map);

        // Remaining route (solid line from car to destination)
        const remainingPath = [
            driverLocation,
            [36.9010, 10.1890],
            [36.9025, 10.1920],
            [36.9040, 10.1940],
            destinationPos
        ];

        L.polyline(remainingPath, {
            color: '#003d6b',
            weight: 4,
            opacity: 1,
            lineCap: 'round'
        }).addTo(map);

        // Fit map to show all markers with padding
        const bounds = L.latLngBounds([...traveledPath, ...remainingPath, destinationPos]);
        map.fitBounds(bounds, { padding: [100, 100] });
    </script>
</body>
</html>